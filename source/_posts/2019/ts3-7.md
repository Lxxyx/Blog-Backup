---
title: TS 3.7 æ–°å¢çš„è¶…ç”œâ€œè¯­æ³•ç³–â€ï¼šOptional Chaining & Nullish coalescing operator
tags: å‰ç«¯
date: 2019-09-30 17:43:55
---
<a name="c7UxF"></a>
## å‰è¨€
å¦‚æœè¯´è¿‘æœŸæˆ‘æœ€å…³æ³¨çš„çš„äº‹æƒ…ï¼Œé‚£ä¹ˆæ— ç–‘æ˜¯ TS 3.7 çš„æ›´æ–°ã€‚å› ä¸ºåœ¨å®˜æ–¹çš„è¿­ä»£è®¡åˆ’ä¸­ï¼Œå…¶åŒ…å«äº†ä¼—å¤šä»¤äººæœŸå¾…çš„æ–°åŠŸèƒ½ã€‚

å…¶ä¸­åœ¨ TS è¯­è¨€å±‚é¢çš„æ›´æ–°ä»¤æˆ‘å°¤ä¸ºæ¿€åŠ¨ï¼ˆå…·ä½“çš„æ”¹åŠ¨å¯ä»¥çœ‹ä¸‹é¢çš„é“¾æ¥ï¼‰

- [Optional Chaining](https://github.com/microsoft/TypeScript/issues/16)
- [Nullish Coalescing](https://github.com/microsoft/TypeScript/issues/26578)
- [Assertion Signatures](https://github.com/microsoft/TypeScript/pull/32695)
- [Recursive Type References](https://github.com/microsoft/TypeScript/pull/33050)
- [ECMAScript Private Fields](https://github.com/Microsoft/TypeScript/pull/30829)
- [Top-LevelÂ `await`](https://github.com/microsoft/TypeScript/issues/25988)

è€Œä»Šå¤©æˆ‘æƒ³ä»‹ç»çš„ï¼Œå°±æ˜¯ TS 3.7 ä¸­ä¸ªäººè®¤ä¸ºæœ€ç”œçš„è¯­æ³•ç³–ï¼šâ€œOptional Chaining & Nullish coalescing operatorâ€

![image.png](https://gw.alicdn.com/tfs/TB1ZXjol.D1gK0jSZFGXXbd3FXa-820-456.png#align=left&display=inline&height=415&name=image.png&originHeight=456&originWidth=820&search=&size=120741&status=done&width=746)

<a name="0PmlD"></a>
## Optional Chaining
è¿™ä¸ª Feature äºæˆ‘è€Œè¨€ï¼Œæ˜¯ç›¸å½“æœ‰ç”¨çš„ç‰¹æ€§ã€‚

å› ä¸ºæˆ‘ç›¸ä¿¡ï¼Œå¤§éƒ¨åˆ†çš„å¼€å‘è€…éƒ½å’Œæˆ‘ä¸€æ ·ï¼Œä¸ºäº†ä¿è¯èƒ½æ­£ç¡®çš„å–åˆ°å€¼ä¸ä»£ç ä¸æŠ¥é”™ã€‚å†™è¿‡è¿™æ ·çš„ä»£ç ï¼š
```javascript
const res = getData()
const videoCover = res && res.data[0] && res.data[0].video && res.data[0].video.cover
```

è™½ç„¶å¯ä»¥é€šè¿‡ä¸€äº›ç±»ä¼¼äº lodash.get/ts-optchain çš„å·¥å…·å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ€»å½’æ˜¯éœ€è¦è€ƒè™‘åŒ…ä½“ç§¯ä¸å…¼å®¹æ€§çš„é—®é¢˜ã€‚

è€Œä¸”è¿™ä¸ª Featureï¼Œå…¶å®å·²ç»åœ¨ C#/Swift/Kotllin/... ç­‰ä¸»æµè¯­è¨€å­˜åœ¨å¤šæ—¶ï¼Œå±äºå¸¸è§åŠŸèƒ½ã€‚<br />äºæ˜¯å°±æœ‰äººåœ¨ TC 39 å‘èµ·äº†Â [proposal-optional-chaining](https://github.com/tc39/proposal-optional-chaining)Â çš„ææ¡ˆï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»æ˜¯å¤„äº Stage 3 çŠ¶æ€ï¼Œå³å°†åˆå¹¶è¿›å…¥ ECMAScriptã€‚

<a name="iEBEq"></a>
### Syntax
è¿™ä¸ªè¯­æ³•ç³–å¯ä»¥è¯´æ˜¯ç›¸å½“ç®€æ´æ˜“æ‡‚äº†ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºã€‚

```javascript
obj?.prop       // optional static property access
obj?.[expr]     // optional dynamic property access
func?.(...args) // optional function or method call
```

ä½ å¯ä»¥é€šè¿‡ ?. çš„æ“ä½œç¬¦ï¼Œå®ç°å¯é€‰é“¾å¼è°ƒç”¨ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š

- è¯»å–å±æ€§
- è¯»å–åŠ¨æ€å±æ€§
- æ‰§è¡Œå‡½æ•°

åŸºæœ¬ä¸Š Cover åˆ°äº†æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„æƒ…å†µã€‚

<a name="HZvev"></a>
### Demo
ä¸¾ä¸ªğŸŒ°ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„è·å–å±æ€§ Demoï¼Œä¸éš¾çœ‹å‡ºè·å–å±æ€§ä»æ­¤å¯ä»¥å˜å¾—éå¸¸ç®€æ´ï¼š<br />

```javascript
let nestedProp = obj.first && obj.first.second;

// ===>

let nestedProp = obj.first?.second;
```

> é€šè¿‡ä½¿ç”¨`?.`æ“ä½œç¬¦å–ä»£`.`æ“ä½œç¬¦ã€‚JavaScriptçŸ¥é“åœ¨å°è¯•è®¿é—®`obj.first.second`ä¹‹å‰å…ˆæ˜ç¡®çš„æ ¡éªŒå¹¶ç¡®å®š`obj.first`tæ˜¯é`null`ä¸”é`undefined`ã€‚å¦‚æœ`obj.first`æ˜¯`null`æˆ–`undefined`ï¼Œè¡¨è¾¾å¼å°†ä¼šçŸ­è·¯è®¡ç®—ç›´æ¥è¿”å›`undefined`ã€‚
> 
> [MDN - Optional Chaining](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/å¯é€‰é“¾)

<br />
<a name="fjjXt"></a>
## Nullish coalescing operator
å¦ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ Feature æ˜¯Â [Nullish Coalescing](proposal-nullish-coalescing)ï¼ŒåŒæ ·ä¹Ÿæ˜¯è¿›å…¥äº† stage 3ã€‚

è¿™æ˜¯ä¸Â [proposal-optional-chaining](https://github.com/tc39/proposal-optional-chaining)Â ååˆ†æ­é…çš„ featureï¼Œé€šè¿‡ ?? æ¥è¡¨ç¤ºé»˜è®¤å€¼çš„åŠŸèƒ½ã€‚ï¼ˆæ„Ÿè§‰åç»­ä¼šçœ‹è§ JS ä¸­éåœ°éƒ½æ˜¯ ?????? çš„åœºæ™¯ã€‚ã€‚ï¼‰

Nullish coalescing çš„ç”¨æ³•å’Œ JS çš„é»˜è®¤å€¼è¯­æ³•ï¼šâ€œ||â€éå¸¸åƒï¼Œä½†è¿˜æ˜¯æœ‰ä¸€äº›æœ¬è´¨çš„ä¸åŒã€‚

â€œ||â€ è¯­æ³•åœ¨è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œå®é™…ä¸Šæ˜¯åŸºäº JS çš„ [Truthy](https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy) ç‰¹æ€§å»åˆ¤æ–­çš„ã€‚éšå¼ç±»å‹è½¬æ¢å¸¦æ¥çš„é—®é¢˜ï¼Œä»£è¡¨ç€åœ¨ â€œ0 || 1Â â€ä¹‹ç±»çš„åœºæ™¯ä¸‹ï¼Œå®é™…ä¸Šå¯èƒ½æ˜¯ä¸ç¬¦åˆç”¨æˆ·æœŸæœ›çš„ã€‚

è€Œ â€œ??â€ çš„åˆ¤æ–­æ¡ä»¶åˆ™æ›´ä¸ºä¸¥è°¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º [nullish](https://v8.dev/features/nullish-coalescing)ã€‚nullish å®é™…ä¸ŠæŒ‡çš„æ˜¯è¿™ä¸ªå€¼ä¸ null/undefined ä¸¥æ ¼ç›¸ç­‰ï¼Œå› æ­¤ä¸Â Optional Chaining å¯ä»¥è¯´æ˜¯ç›¸å½“æ­é…äº†ã€‚

<a name="VShe9"></a>
### Demo
ä¸¾ä¸ªğŸŒ°ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç¤ºä¾‹äº†è§£è¿™ä¸ª featureã€‚

```javascript
false ?? true;   // => false
0 ?? 1;          // => 0
'' ?? 'default'; // => ''

null ?? [];      // => []
undefined ?? []; // => []
```

<a name="Ekzb0"></a>
### çœŸç”œ
ä¸Šé¢ä¸¤ä¸ª feature æ€»ç»“ä¸‹æ¥ï¼Œéå¸¸ç¬¦åˆè¯­æ³•ç³–çš„ç‰¹æ€§ï¼šâ€œä½¿ç”¨ç®€å•ï¼Œç”¨æˆ·å‹å¥½â€ã€‚

è€ŒåŒæ—¶åœ¨ TC39 çš„ [Proposals](https://github.com/tc39/proposals) ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¸å¤šç±»ä¼¼çš„ææ¡ˆæ­£åœ¨ä¸æ–­çš„è¢«æå‡ºï¼Œä¸æ–­çš„åœ¨ç®€åŒ–ç€æˆ‘ä»¬çš„ç¼–ç ï¼š

- [globalThis](https://www.npmjs.com/package/globalthis)
- [Private fields](https://github.com/tc39/proposal-class-fields)
- â€¦â€¦

ä¸å¾—ä¸è¯´ï¼Œè™½ç„¶è¯­æ³•ç³–æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œä½†æ˜¯ï¼š

![image.png](https://gw.alicdn.com/tfs/TB1nP5OlV67gK0jSZPfXXahhFXa-500-313.png#align=left&display=inline&height=157&name=image.png&originHeight=313&originWidth=500&search=&size=263939&status=done&width=250)
